#!/usr/bin/env ruby

require 'rubygems'
require 'optparse'

require "kivot/pivotal_poster"

options = {}
option_parser = OptionParser.new do |opts|
  opts.on("-t", "--token TOKEN",
          "Use the Pivotal Tracker API token TOKEN") do |token|
    options[:token] = token
  end

  opts.on("-p", "--project_id ID",
          "Add stories to the project identified by ID") do |project_id|
    options[:project_id] = project_id
  end

  opts.banner = "Usage: kivot [options] NAME [DESCRIPTION]"
end
option_parser.parse!

name = ARGV[0]
description = ARGV[1]

unless name
  puts option_parser.banner
  exit(1)
end

poster_options = {
  :description => description
}

poster = Kivot::PivotalPoster.new(options[:token], options[:project_id])
poster.post_story(name, poster_options)
